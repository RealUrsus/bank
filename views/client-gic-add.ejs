<!doctype html>
<html lang="en">
  <head>
    <%- include('partials/head'); %>
    <link rel="stylesheet" href="/css/sidebar.css">
  </head>
  <body>
    <header>
      <%- include('partials/header'); %>
    </header>
    <main class="container-fluid d-flex flex-nowrap">
      <aside class="border">
        <%- include('partials/client/sidebar'); %>
      </aside>
      <!-- Content -->
      <div class="flex-grow-1 p-3">
        <h2 class="mb-3">Available GIC Investments</h2>
        <p>Your current balance: <strong>$<%= parseFloat(approved_balance).toFixed(2) %></strong></p>

        <% if (typeof locals.session !== 'undefined' && locals.session.message) { %>
        <div class="alert alert-warning alert-dismissible fade show" role="alert">
          <%= locals.session.message %>
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        <% } %>

        <div class="row">
          <% if (gicProducts && gicProducts.length > 0) { %>
            <% gicProducts.forEach(product => { %>
            <div class="col-md-6 col-lg-4 mb-4">
              <div class="card">
                <div class="card-body">
                  <h5 class="card-title"><%= product.ProductName %></h5>
                  <p class="card-text">
                    <strong>Interest Rate:</strong> <%= product.InterestRate %>%<br>
                    <strong>Term:</strong> <%= product.Term %> months<br>
                    <strong>Minimum Amount:</strong> $<%= parseFloat(product.MinimumAmount).toFixed(2) %>
                  </p>
                  <% if (approved_balance >= product.MinimumAmount) { %>
                  <form action="/client/gic/purchase/<%= product.ProductID %>" method="post" class="mt-3">
                    <div class="mb-3">
                      <label for="amount_<%= product.ProductID %>" class="form-label">Investment Amount</label>
                      <input type="number" class="form-control" id="amount_<%= product.ProductID %>" name="amount"
                             min="<%= product.MinimumAmount %>" step="0.01"
                             value="<%= product.MinimumAmount %>" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Purchase</button>
                    <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                  </form>
                  <% } else { %>
                  <p class="text-muted">Insufficient balance</p>
                  <% } %>
                </div>
              </div>
            </div>
            <% }) %>
          <% } else { %>
          <p class="text-muted">No GIC products available at this time.</p>
          <% } %>
        </div>
      </div>
    </main>
    <footer>
      <%- include('partials/footer'); %>
    </footer>
    <script src="/js/feather.min.js"></script>
    <script>feather.replace()</script>
  </body>
</html>
