<!doctype html>
<html lang="en">
	<head>
		<%- include('partials/head'); %>
		<link rel="stylesheet" href="/css/sidebar.css">
	</head>
	<body>
		<header>
			<%- include('partials/header'); %>
		</header>

		<main class="container-fluid d-flex flex-nowrap">
			<aside class="border">
				<%- include('partials/admin/sidebar'); %>
			</aside>
			<!-- Content -->
			<div class="p-5 w-100">
				<h2 class="mb-4">Admin Dashboard</h2>

				<!-- Notifications Section -->
				<div class="row mb-4">
					<% if (pendingTransactionsCount > 0) { %>
					<div class="col-md-4 mb-3">
						<div class="alert alert-warning" role="alert">
							<h5 class="alert-heading">
								<i data-feather="alert-circle"></i> Pending Transactions
							</h5>
							<p class="mb-2">You have <strong><%= pendingTransactionsCount %></strong> transaction(s) awaiting approval.</p>
							<a href="/admin/transactions" class="btn btn-sm btn-warning">Review Transactions</a>
						</div>
					</div>
					<% } %>

					<% if (pendingLoansCount > 0) { %>
					<div class="col-md-4 mb-3">
						<div class="alert alert-info" role="alert">
							<h5 class="alert-heading">
								<i data-feather="file-text"></i> Pending Loan Requests
							</h5>
							<p class="mb-2">You have <strong><%= pendingLoansCount %></strong> loan request(s) awaiting approval.</p>
							<a href="/admin/loans/requests" class="btn btn-sm btn-info">Review Loan Requests</a>
						</div>
					</div>
					<% } %>

					<% if (maturingCount > 0) { %>
					<div class="col-md-4 mb-3">
						<div class="alert alert-primary" role="alert">
							<h5 class="alert-heading">
								<i data-feather="calendar"></i> Maturing Accounts
							</h5>
							<p class="mb-2">
								<strong><%= maturingCount %></strong> account(s) maturing within 30 days.
								<% if (maturingLoans.length > 0) { %>
									<br><small><%= maturingLoans.length %> loan(s)</small>
								<% } %>
								<% if (maturingGICs.length > 0) { %>
									<br><small><%= maturingGICs.length %> investment(s)</small>
								<% } %>
							</p>
							<button type="button" class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#maturingModal">
								View Details
							</button>
						</div>
					</div>
					<% } %>

					<% if (pendingTransactionsCount === 0 && pendingLoansCount === 0 && maturingCount === 0) { %>
					<div class="col-12">
						<div class="alert alert-success" role="alert">
							<h5 class="alert-heading">
								<i data-feather="check-circle"></i> All Clear!
							</h5>
							<p class="mb-0">No pending transactions, loan requests, or maturing accounts at this time.</p>
						</div>
					</div>
					<% } %>
				</div>

				<!-- Quote Section -->
				<div class="mt-5 pt-4 border-top">
					<h3>И от всякого, кому дано много, много и потребуется, и кому много вверено, с того больше взыщут</h3>
					<hr>
					<h3>Un gran poder conlleva una gran responsabilidad</h3>
					<hr>
					<h3>With great power comes great responsibility</h3>
					<hr>
					<h3>大いなる力には、大いなる責任が伴う</h3>
				</div>
			</div>

			<!-- Maturing Accounts Modal -->
			<div class="modal fade" id="maturingModal" tabindex="-1" aria-labelledby="maturingModalLabel" aria-hidden="true">
				<div class="modal-dialog modal-lg">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title" id="maturingModalLabel">Maturing Accounts (Next 30 Days)</h5>
							<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
						</div>
						<div class="modal-body">
							<% if (maturingLoans.length > 0) { %>
							<h6>Loans</h6>
							<div class="table-responsive mb-4">
								<table class="table table-sm">
									<thead>
										<tr>
											<th>Account ID</th>
											<th>User</th>
											<th>Amount</th>
											<th>Maturity Date</th>
											<th>Days Until Maturity</th>
										</tr>
									</thead>
									<tbody>
										<% maturingLoans.forEach(loan => { %>
										<tr>
											<td><%= loan.AccountID %></td>
											<td>User #<%= loan.UserID %></td>
											<td>$<%= loan.PrincipalAmount.toFixed(2) %></td>
											<td><%= loan.maturityDate %></td>
											<td><%= loan.daysUntilMaturity %> days</td>
										</tr>
										<% }); %>
									</tbody>
								</table>
							</div>
							<% } %>

							<% if (maturingGICs.length > 0) { %>
							<h6>Investments (GICs)</h6>
							<div class="table-responsive">
								<table class="table table-sm">
									<thead>
										<tr>
											<th>Account ID</th>
											<th>User</th>
											<th>Amount</th>
											<th>Maturity Date</th>
											<th>Days Until Maturity</th>
										</tr>
									</thead>
									<tbody>
										<% maturingGICs.forEach(gic => { %>
										<tr>
											<td><%= gic.AccountID %></td>
											<td>User #<%= gic.UserID %></td>
											<td>$<%= gic.PrincipalAmount.toFixed(2) %></td>
											<td><%= gic.maturityDate %></td>
											<td><%= gic.daysUntilMaturity %> days</td>
										</tr>
										<% }); %>
									</tbody>
								</table>
							</div>
							<% } %>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
						</div>
					</div>
				</div>
			</div>
		</main>
		<footer>
			<%- include('partials/footer'); %>
		</footer>

		<!-- Icons -->
		<script src="/js/feather.min.js"></script>
		<script>feather.replace()</script>
	</body>
</html>
