<!doctype html>
<html lang="en">
  <head>
    <%- include('partials/head'); %>
    <link rel="stylesheet" href="/css/sidebar.css">
    <link rel="stylesheet" href="/css/client-common.css">
  </head>
  <body>
    <header>
      <%- include('partials/header'); %>
    </header>
    <main class="container-fluid d-flex flex-nowrap">
      <aside class="border">
        <%- include('partials/client/sidebar'); %>
      </aside>
      <!-- Content -->
      <div class="p-3">
        <div id="pastDateWarning" class="alert alert-warning alert-dismissible fade show" role="alert" style="display: none;">
          <strong>Warning:</strong> The selected start date is in the past. Are you sure you want to proceed?
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        <form action="/client/loan/add" method="post" class="row g-2 align-items-center">
          <div class="input-group mb-3">
            <div class="form-floating mb-3">
              <input type="date" class="form-control" id="date" name="date" placeholder="Start date">
              <label for="date" class="form-label required">Start Date:</label>              
            </div>
            <div class="form-floating mb-3">
              <input type="text" class="form-control" id="amount" name="amount" pattern="^\d+(\.\d+)?$" placeholder="Amount" aria-label="Amount">
              <label for="amount">Amount</label>
            </div>            
          </div>          
          <div class="input-group mb-3">
            <div class="form-floating mb-3">
              <input type="number" class="form-control" id="interest" name="interest" placeholder="Interest Rate" min="0" max="100" step="0.1" value="0.0" required>
              <label for="interest" class="form-label required">Interest Rate:</label>
            </div>
            <div class="form-floating mb-3">
              <select class="form-select" id="paymentFrequency" name="paymentFrequency" aria-label="Payment Frequency" required>
                <option value="" disabled selected>Select frequency...</option>
                <option value="monthly">Monthly</option>
                <option value="annually">Annually</option>
              </select>
              <label for="paymentFrequency">Payment Frequency</label>
            </div>
            <div class="form-floating mb-3">
              <select class="form-select" id="term" name="term" aria-label="Term" required>
                <option value="" disabled selected>Select a term...</option>
                <option value="12">12 months</option>
                <option value="24">24 months</option>
                <option value="36">36 months</option>
                <option value="48">48 months</option>
                <option value="60">60 months</option>
              </select>
              <label for="term">Term</label>
            </div>
          </div>
          <div class="form-floating mb-3">
            <textarea class="form-control" placeholder="Loan purpose" id="description" name="description"></textarea>
            <label for="description">What is the intended use of this loan?</label>
          </div>
          <div class="col-auto">
            <button type="reset" class="btn btn-secondary">Reset</button>
            <button type="submit" class="btn btn-primary">Submit</button>
          </div>
          <input type="hidden" name="_csrf" value="<%= csrfToken %>">
        </form>
      </div>
    </main>
    <footer>
      <%- include('partials/footer'); %>
    </footer>
    <script src="/js/feather.min.js"></script>
    <script>feather.replace()</script>
    <script>
      // Check for past date on loan start date field and prevent submission
      const dateInput = document.getElementById('date');
      const warningDiv = document.getElementById('pastDateWarning');
      const form = document.querySelector('form');

      function isPastDate(dateString) {
        if (!dateString) return false;

        // Get today's date in YYYY-MM-DD format
        const today = new Date();
        const todayString = today.getFullYear() + '-' +
                           String(today.getMonth() + 1).padStart(2, '0') + '-' +
                           String(today.getDate()).padStart(2, '0');

        // Compare date strings directly (today and future are allowed)
        return dateString < todayString;
      }

      dateInput.addEventListener('change', function() {
        if (isPastDate(this.value)) {
          warningDiv.style.display = 'block';
        } else {
          warningDiv.style.display = 'none';
        }
      });

      // Prevent form submission if date is in the past
      form.addEventListener('submit', function(e) {
        if (isPastDate(dateInput.value)) {
          e.preventDefault();
          warningDiv.style.display = 'block';
          warningDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
          return false;
        }
      });
    </script>
  </body>
</html>
