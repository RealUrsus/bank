<!doctype html>
<html lang="en">
	<head>
		<%- include('partials/head'); %>
		<link rel="stylesheet" href="/css/sidebar.css">
	</head>
	<body>
		<header>
			<%- include('partials/header'); %>
		</header>

		<main class="container-fluid d-flex flex-nowrap">
			<aside class="border">
				<%- include('partials/admin/sidebar'); %>
			</aside>
        <!-- Content -->
        <div class="flex-grow-1 p-5">
          <% if (agreements && agreements.length > 0) { %>
          <input class="form-control mb-3" id="myInput" type="text" placeholder="Search..">
          <table class="table table-bordered table-striped">
            <thead>
              <tr>
                <th>Name</th>
                <th>Surname</th>
                <th>Agreement</th>
                <th>Status</th>
                <th style="width: 200px; text-align: center;">Action</th>
              </tr>
            </thead>
            <tbody id="myTable">
              <% agreements.forEach(agreement => { %>
                  <tr>
                  <td><%= agreement.Name %></td>
                  <td><%= agreement.Surname %></td>
                  <td><%= agreement.AgreementName %></td>
                  <td>
                    <% if (agreement.StatusName === 'Active') { %>
                      <span class="badge bg-success"><%= agreement.StatusName %></span>
                    <% } else if (agreement.StatusName === 'Pending') { %>
                      <span class="badge bg-warning text-dark"><%= agreement.StatusName %></span>
                    <% } else if (agreement.StatusName === 'Closed' || agreement.StatusName === 'Cancelled') { %>
                      <span class="badge bg-secondary"><%= agreement.StatusName %></span>
                    <% } else { %>
                      <span class="badge bg-info text-dark"><%= agreement.StatusName %></span>
                    <% } %>
                  </td>
                  <td class="text-center">
                    <div class="btn-group" role="group">
                      <a href="/admin/agreements/edit/<%= agreement.AgreementID %>" class="btn btn-primary btn-sm">Edit</a>
                      <form action="/admin/agreements/delete" method="POST" class="d-inline">
                        <input type="hidden" name="id" value="<%= agreement.AgreementID %>">
                        <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to delete this agreement?')">Delete</button>
                        <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                      </form>
                    </div>
                  </td>
                  </tr>
              <% }) %>
            </tbody>
          </table>
          <% } else { %>
          <div class="alert alert-info" role="alert">
            <h5 class="alert-heading">No agreements found</h5>
            <p>There are currently no agreements in the system.</p>
          </div>
          <% } %>
        </div>
              
          <script>
            document.addEventListener("DOMContentLoaded", function() {
              var input = document.getElementById("myInput");
              var debounceTimer;

              input.addEventListener("keyup", function() {
                clearTimeout(debounceTimer);
                debounceTimer = setTimeout(function() {
                  var filter = input.value.toLowerCase();
                  var rows = document.querySelectorAll("#myTable tr");
                  var visibleCount = 0;

                  rows.forEach(function(row) {
                    var text = row.textContent.toLowerCase();
                    var shouldShow = !filter || text.includes(filter);
                    row.style.display = shouldShow ? "" : "none";
                    if (shouldShow) visibleCount++;
                  });
                }, 200);
              });
            });
          </script>
    </main>
		  
		<footer>
			<%- include('partials/footer'); %>
		</footer>

    <!-- Icons -->
    <script src="https://unpkg.com/feather-icons/dist/feather.min.js"></script>
    <script>
      feather.replace()
    </script>
	</body>
</html>